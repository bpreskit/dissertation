
Herein we will assume Algorithm~\ref{alg:phaseRetrieval1} is provided with measurements $\y$ of the form \eqref{eq:shift_model_noise} such that the linear operator \eqref{eq:linear} is invertible on $T_{\delta}(\C^{d \times d})$ with condition number $\kappa > 0$.  Unless otherwise stated, we follow the notation of \S \ref{sec:locCorrMeas}- \S\ref{sec:mainRes}; therefore, our assumptions imply that $\lVert \X - \X_0 \rVert_F \le \kappa \lVert \n \rVert_2$.
%% Herein we will assume that Algorithm~\ref{alg:phaseRetrieval1} is provided with measurements $\y$ that are generated by the locally supported masks defined in  Section \ref{sec:MeasMatrix}.  As a result, we will be able to utilize Theorem~\ref{thm:WellCondMeas} as desired.  To begin, one can see from \eqref{equ:MeasModel} and \eqref{equ:LinProb} that the vector ${\bf z}'$ computed in line 1 of Algorithm~\ref{alg:phaseRetrieval} satisfies  
%% \begin{equation}
%% \z' = {\bf z} + (M')^{-1} P \n
%% \label{equ:InvertedNoiseyMeas}
%% \end{equation}
%% where $\z$ is defined as in \eqref{equ:Defz} and \eqref{equ:LinProb}.  Note that Theorem~\ref{thm:WellCondMeas} implies that $\|  (M')^{-1} P \n \|_2 \leq C \delta \|  \n \|_2$ for an absolute constant $C \in \mathbbm{R}^+$.  Thus, we have a bound on the perturbation to the entires of the matrix $X$ formed in line 3 of Algorithm~\ref{alg:phaseRetrieval}.

%%We will prove our final result by introducing a proxy signal, $\x' \in \C^d$, whose entries are identical to the entries of $\x_0$ when their magnitudes are large, and that have the phases of the computed signal $\x$ otherwise.  That is, we let
%%$$x'_j := \left\{ \begin{array}{ll} \left( x_0 \right)_j & \textrm{if}~ | \left( x_0 \right)_j | \geq \sqrt{\frac{\delta \| \n \|_2}{\rho}}\\
%%| \left( x_0 \right)_j | \cdot \tilde{x}_j & \textrm{else} \end{array} \right..$$
%%where $\rho \in \mathbbm{R}^+$ is a free parameter.  
We now aim to bound the Frobenius norm of the perturbation error $(\tilde{X} - \tilde{\X}_0)$ present in the matrix $\tilde{X}$ formed in line 2 of Algorithm~\ref{alg:phaseRetrieval1}.
Toward this end we define the set of $\rho$-small indexes of $\x_0$ to be 
\begin{equation}
S_\rho := \left\{ j~\bigg|~ | \left( x_0 \right)_j | < \left(\frac{\kappa \| \n \|_2}{\rho} \right)^{\frac{1}{4}} \right\}
\label{equ:SrhoDef}
\end{equation}
where $\rho \in \mathbbm{R}^+$ is a free parameter.  
%---------------------------------------------------------------------\\
%
%INSERT DISCUSSION CONCERNING $S_\rho$!  OR MAYBE MOVE THE DISCUSSION AND EXAMPLES UP TO THE INTRODUCTION WHERE WE STATE OUR MAIN RESULTS????  It measures the flatness, or non-sparsity of $\x_0$.  The noise only has to erase a $\mathcal{O}(\delta^2)$ diagonal block of $X$ in order to disconnect our angular synchronization problem into two separate problems whose two separate global phase errors we can never hope to rectify.  This tells us that we will be most robust on signals $\x_0$ which have no sequences of $\delta$ small entries in a row.  The set $S_\rho$ tells us how "small" any such set of entries can be.  Generally, we would choose $\rho$ so that $|S_\rho|$ is very small in order to get a best bound....\\
%
%---------------------------------------------------------------------\\
With the definition of $S_\rho$ in hand we can bound the perturbation error $(\tilde{X} - \tilde{\X}_0)$ using the next lemma.
%%Note that this set also depends on the parameter $\rho$, and exactly records the entires of $\x'$ which are not identical to entires of $\x_0$.  As in \eqref{equ:PhaseMatrix} and \eqref{equ:MatrixofPhases} we now define $\X'$ and $\tilde{\X}'$ by
%%\begin{equation}
%%\X'_{j,k} =  \left\{ \begin{array}{ll} ({\bf x}' {\bf x}'^*)_{j,k} & \textrm{if}~| j - k ~{\rm mod}~d | < \delta \\ 0 & \textrm{otherwise} \end{array} \right..
%%\end{equation}
%%Normalizing each entry of $\X' \in \mathbbm{C}^{d \times d}$ one obtains the Hermitian matrix $\tilde{\X}' \in \mathbbm{C}^{d \times d}$ with entries
%%\begin{equation}
%%\tilde{\X}'_{j,k} =  \left\{ \begin{array}{ll} \mathbbm{e}^{\mathbbm{i}(\theta_j - \theta_k)} & \textrm{if}~| j - k ~{\rm mod}~d | < \delta \\ 0 & \textrm{otherwise} \end{array} \right.,
%%\label{equ:MatrixofPhases}
%%\end{equation}
%%where $x'_j = s_j \mathbbm{e}^{\mathbbm{i} \theta_j}$ for $j \in [d]$.  

\begin{lem}
Let $\tilde{\X}$ be the matrix computed in line 2 of Algorithm~\ref{alg:phaseRetrieval1}.  We have that $$\| \tilde{\X} - \tilde{\X}_0 \|_{\rm F} \leq C \sqrt{\frac{\rho \frac{\kappa}{\delta} \| \n \|_2 + \left| S_\rho \right|}{d}} \cdot \| \tilde{\X}_0 \|_{\rm F}$$
holds for all $\rho \in \R^+$, where $C$ is an absolute constant.
\label{lem:EtaBound}
\end{lem}

\begin{proof}
%% For any $j,k$ with 
%% $| j - k |~{\rm mod}~d  < \delta$ we have that 
%% $$|(\tilde{\X}_0)_{jk} - \tilde{\X}_{jk}| = |\mathbbm{e}^{\mathbbm{i}(\phi_{jk} - \beta_{jk})} - 1| = 2 \sin \left(  \frac{| \phi_{jk} - \beta_{jk} |}{2} \right)$$
%% where $\phi_{jk} = \arg (\tilde{\X}_0)_{jk}$ and $\beta_{jk} = \arg (\tilde{\X}_{j,k})$.  Defining $N_{jk} = \X_{jk} - (\X_0)_{jk}$, the law of sines now implies that $$2 \sin \left(  \frac{| \phi_{jk} - \beta_{jk} |}{2} \right) \leq 2 \left| \sin \left(  \frac{\phi_{jk} - \beta_{jk} }{2} \right) \right| \leq 2 \frac{|N_{jk}|}{| (\X_0)_{jk} |} \leq 2 \rho^{\frac{1}{2}} \frac{|N_{jk}|}{(\kappa \| \n \|_2)^{\frac{1}{2}}}$$ whenever $j,k \in S_\rho^{c}$.
Set $N_{jk} = X_{jk} - (X_0)_{jk}$ and consider that, for any $j, k \in S_\rho^c$, %
\[\begin{array}{rcccl}
|(\tX_0)_{jk} - \tX_{jk}| & = & \left|(\tX_0)_{jk} - \sgn\left(\frac{X_{jk}}{|(X_0)_{jk}|}\right)\right| & \le & \left|(\tX_0)_{jk} - \frac{X_{jk}}{|(X_0)_{jk}|}\right| + \left|\frac{X_{jk}}{|(X_0)_{jk}|} - \sgn\left(\frac{X_{jk}}{|(X_0)_{jk}|}\right)\right| \\
&\le &2\left|(\tX_0)_{jk} - \frac{X_{jk}}{|(X_0)_{jk}|}\right| & = & 2\frac{|N_{jk}|}{|(X_0)_{jk}|} \le 2 \rho^{\frac{1}{2}} \frac{|N_{jk}|}{(\kappa \| \n \|_2)^{\frac{1}{2}}}.
\end{array}\]

Thus, there exists an absolute constant $C' \in \R^+$ such that%
\begin{align*}
\| \tilde{\X} - \tilde{\X}_0 \|^2_{\rm F} &\leq \sum_{j,k \in S_\rho^{c}} 4 \rho \frac{|N_{jk}|^2}{\kappa \| \n \|_2} + \sum_{j \in S_\rho, ~{\rm or}~ k \in S_\rho} |(\tilde{\X}_0)_{jk} - \tilde{\X}_{jk}|^2\\ &\leq 4 \rho \frac{\| N \|^2_{\rm F}}{\kappa \| \n \|_2} + \sum_{j \in S_\rho} 4 \cdot (4\delta - 3) = 4 \rho \frac{\| N \|^2_{\rm F}}{\kappa \| \n \|_2} + 4 \cdot (4\delta - 3) \left| S_\rho \right| \\ & \leq C' (\rho \kappa \| \n \|_2 + \delta \left| S_\rho \right|).
\end{align*}%
The proof is completed by recalling that $\lVert \tX_0 \rVert_F = \sqrt{(2\delta - 1)d}$.
\end{proof}

We are finally ready to prove a robustness result for Algorithm~\ref{alg:phaseRetrieval1}.

\begin{thm}
Suppose that $\tilde{\X}$ and $\tilde{\X}_0$ satisfy $\Vert \tilde{\X} - \tilde{\X}_0 \Vert_{\rm F}~\leq \eta \Vert \tilde{\X}_0 \Vert_F$ for some $\eta>0$.
Then, the estimate $\x$ produced by Algorithm~\ref{alg:phaseRetrieval1} satisfies 
\[ \min_{\theta \in [0, 2 \pi]} \left\Vert  \x_0 - \mathbbm{e}^{\mathbbm{i} \theta} \x \right\Vert_2 \leq C \Vert \x_0 
        \Vert_{\infty} \left( \frac{d^{5/2}}{\delta^2} \right) \eta  + C  d^{\frac{1}{4}} \sqrt{\kappa \| \n \|_2 },\]
where $C \in \mathbb{R}^+$ is an absolute universal constant.  Alternatively, one can bound the error in terms of the size of the index set $S_\rho$ from \eqref{equ:SrhoDef} as 
\begin{equation}
\min_{\theta \in [0, 2 \pi]} \left\Vert  \x_0 - \mathbbm{e}^{\mathbbm{i} \theta} \x \right\Vert_2 \leq C' \Vert \x_0 
        \Vert_{\infty} \left( \frac{d}{\delta} \right)^2 \sqrt{\rho \frac{\kappa}{\delta} \| \n \|_2 + \left| S_\rho \right|} + C' d^{\frac{1}{4}} \sqrt{\kappa \| \n \|_2 }, \label{equ:ManRes2} 
\end{equation}
for any desired $\rho \in \R^+$, where $C' \in \mathbb{R}^+$ is another absolute universal constant.
\label{thm:MainRes}
\end{thm}

\begin{proof}

Let $\phi \in [0,2 \pi)$ be arbitrary;  % be such that $\Re\left( \langle \tilde{\x}_0,\mathbbm{e}^{\mathbbm{i} \phi} \tilde{\x} \rangle \right) = \left| \langle \tilde{\x}_0, \tilde{\x} \rangle \right|$. 
then $\mathbbm{e}^{\mathbbm{i} \phi }\x = |\x| \circ \mathbbm{e}^{\mathbbm{i} \phi} \tilde{\x}$ and $\x_0 = |\x_0| \circ \tilde{\x}_0$, where $\circ$ denotes the entrywise (Hadamard) product.

We see that%
\begin{align*}
\min_{\phi \in [0, 2 \pi]} \| \x_0 - \mathbbm{e}^{\mathbbm{i} \phi }\x \|_2 &= \min_{\phi \in [0, 2 \pi]} \left\| |\x_0| \circ \tilde{\x}_0 - |\x| \circ \mathbbm{e}^{\mathbbm{i} \phi} \tilde{\x} \right\|_2 \\
&\leq \min_{\phi \in [0, 2 \pi]} \left\| |\x_0| \circ \tilde{\x}_0 - |\x_0| \circ \mathbbm{e}^{\mathbbm{i} \phi} \tilde{\x}  \right\|_2 + \left\| |\x_0| \circ \mathbbm{e}^{\mathbbm{i} \phi} \tilde{\x}  - |\x| \circ \mathbbm{e}^{\mathbbm{i} \phi} \tilde{\x}  \right\|_2 
\end{align*}
where the second term is now independent of $\phi$.  As a result we have that
\begin{equation*}
\min_{\phi \in [0, 2 \pi]} \| \x_0 - \mathbbm{e}^{\mathbbm{i} \phi }\x \|_2 \leq \| \x_0 \|_{\infty} \left( \min_{\phi \in [0, 2 \pi]} \| \tilde{\x}_0 - \mathbbm{e}^{\mathbbm{i} \phi} \tilde{\x} \|_2 \right) + C'' \sqrt{\kappa \sqrt{d} \cdot \| \n \|_2 }
\end{equation*}
for some absolute constant $C'' \in \mathbbm{R}^+$.  Here the bound on the second term follows from Lemma 3 of \cite{IVW2015_FastPhase} and the Cauchy-Schwarz inequality.  %Both Theorems~\ref{cor2:GenBound} and~\ref{thm:EB} may now be used to bound the first term.\\
%
%{\bf !! TO MIRROR KRON THM BOUND MOVE THIS UP INTO SPECTRUM SECTION.}\\
%
%\begin{align*}
%\| \tilde{\x}_0 - \mathbbm{e}^{\mathbbm{i} \phi} \tilde{\x} \|^2_2 &= 2d - 2 \Re\left( \langle \tilde{\x}_0,\mathbbm{e}^{\mathbbm{i} \phi} \tilde{\x} \rangle \right) \\
%&= 2d \left( 1 - \frac{1}{d} \left| \langle \tilde{\x}_0, \tilde{\x} \rangle \right| \right) \leq 2d \left( 1 - \frac{1}{d^2} \left| \langle \tilde{\x}_0, \tilde{\x} \rangle \right|^2 \right).
%\end{align*}
The first inequality of the theorem now results from an application of Corollary~\ref{cor:GenBoundv2} to the first term.  The second inequality then follows from Lemma~\ref{lem:EtaBound}.
\end{proof}

Looking at the second inequality \eqref{equ:ManRes2} in Theorem~\ref{thm:MainRes} we can see that the error bound there will be vacuous in most settings unless $S_\rho = \emptyset$.  Recalling \eqref{equ:SrhoDef}, one can see that $S_\rho$ will be empty as soon as $\rho = \kappa \delta \| \n \|_2 / \left| (x_0)_{\rm min} \right|^4$, where $(x_0)_{\rm min}$ is the smallest magnitude of any entry in $\x_0$.  Utilizing this value of $\rho$ in \eqref{equ:ManRes2} leads to the following corollary of Theorem~\ref{thm:MainRes}.

\begin{cor}
Let $(x_0)_{\rm min} := \min_j |(x_0)_j|$ be the smallest magnitude of any entry in $\x_0$.  Then, the estimate $\x$ produced by Algorithm~\ref{alg:phaseRetrieval1} satisfies 
\[ \min_{\theta \in [0, 2 \pi]} \left\Vert  \x_0 - \mathbbm{e}^{\mathbbm{i} \theta} \x \right\Vert_2 \leq C \left( \frac{\Vert \x_0 
        \Vert_{\infty}}{(x_0)^2_{\rm min}} \right) \left( \frac{d}{\delta} \right)^2 \kappa \| \n \|_2 + C d^{\frac{1}{4}} \sqrt{\kappa \| \n \|_2 },\]
where $C \in \mathbb{R}^+$ is an absolute universal constant.  
\label{Cor:RecovRes}
\end{cor}

Corollary~\ref{Cor:RecovRes} yields a deterministic recovery result for any signal $\x_0$ which contains no zero entries.  If desired, a randomized result can now be derived from Corollary~\ref{Cor:RecovRes} for arbitrary $\x_0$ by right multiplying the signal $\x_0$ %% \eqref{equ:MblockDecomp}
with a random ``flattening'' matrix as done in \cite{IVW2015_FastPhase}.   Finally, we note that a trivial variant of Corollary~\ref{Cor:RecovRes} can also be combined with the discussion in \S \ref{sec:STFT} in order to generate recovery guarantees for the windowed Fourier measurements defined by \eqref{eq:STFT_measurements}.  However, we will leave such variants and extensions to the interested reader.
